services:
  rabbitmq:
    image: rabbitmq:3-management-alpine

  redis:
    image: redis:alpine

  zipkin:
    image: openzipkin/zipkin-slim:latest

  seq:
    image: datalust/seq:latest

  catalogdb:
    image: postgres

  identitydb:
    image: postgres

  basket-api:
    image: ${DOCKER_REGISTRY-racketsport/}basket.api:${TAG:-latest}
    build:
      context: .
      dockerfile: src/Services/Basket/Basket.Api/Dockerfile
    depends_on:
      - redis

  basket-api-dapr:
    image: "daprio/daprd:1.13.5"
    network_mode: "service:basket-api"
    depends_on:
      - basket-api

  catalog-api:
    image: ${DOCKER_REGISTRY-racketsport/}catalog.api:${TAG:-latest}
    build:
      context: .
      dockerfile: src/Services/Catalog/Catalog.Api/Dockerfile
    depends_on:
      - catalogdb

  catalog-api-dapr:
    image: "daprio/daprd:1.13.5"
    network_mode: "service:catalog-api"
    depends_on:
      - catalog-api

  identity-api:
    image: ${DOCKER_REGISTRY-racketsport/}identity.api:${TAG:-latest}
    build:
      context: .
      dockerfile: src/Services/Identity/Identity.Api/Dockerfile
    depends_on:
      - identitydb

  identity-api-dapr:
    image: "daprio/daprd:1.13.5"
    network_mode: "service:identity-api"
    depends_on:
      - identity-api

  dapr-placement:
    image: "daprio/dapr:1.13.5"
